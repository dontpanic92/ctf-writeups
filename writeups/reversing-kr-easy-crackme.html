<!DOCTYPE html>
<html lang="zh-Hans">

<head>
    <meta charset="utf-8"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Easy CrackMe | dontpan1c 的 CTF 笔记</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Easy CrackMe" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="双击点开 Easy CrackMe.exe，将弹出一个对话框，要求输入密码。点击按钮后将对密码进行验证。" />
<meta property="og:description" content="双击点开 Easy CrackMe.exe，将弹出一个对话框，要求输入密码。点击按钮后将对密码进行验证。" />
<link rel="canonical" href="https://ctf.dontpanic.blog/writeups/reversing-kr-easy-crackme.html" />
<meta property="og:url" content="https://ctf.dontpanic.blog/writeups/reversing-kr-easy-crackme.html" />
<meta property="og:site_name" content="dontpan1c 的 CTF 笔记" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-02-03T00:00:00+00:00" />
<script type="application/ld+json">
{"description":"双击点开 Easy CrackMe.exe，将弹出一个对话框，要求输入密码。点击按钮后将对密码进行验证。","@type":"BlogPosting","url":"https://ctf.dontpanic.blog/writeups/reversing-kr-easy-crackme.html","headline":"Easy CrackMe","dateModified":"2019-02-03T00:00:00+00:00","datePublished":"2019-02-03T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ctf.dontpanic.blog/writeups/reversing-kr-easy-crackme.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/fontawesome.min.css">
    <script src="/assets/js/index.js"></script>
</head>

<body>
    <div class="d-flex flex-grow-1 flex-column h-100">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="/">dontpan1c 的 CTF 笔记</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor03"
                aria-controls="navbarColor03" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarColor03">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">首页</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://dontpanic.blog" target="_blank">博客</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://dontpanic.blog/about" target="_blank">关于</a>
                    </li>
                </ul>
                <ul class="navbar-nav dp-navbar-right">
                    <li class="nav-item">
                        <a class="nav-link" href="https://github.com/dontpanic92/ctf-writeups" target="_blank">
                            <i class="fab fa-github"></i><span>&nbsp;仓库</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/feed.xml" target="_blank">
                            <i class="fas fa-rss"></i><span>&nbsp;订阅</span>
                        </a>
                    </li>
                </ul>
                <form class="form-inline my-2 my-lg-0" action="/search" method="GET">
                    <input name="query" class="form-control mr-sm-2" type="text" placeholder="搜索">
                    <button class="btn btn-secondary my-2 my-sm-0" type="submit">搜索</button>
                </form>
            </div>
        </nav>
        <div class="d-flex flex-grow-1 h-100 container pt-3 justify-content-center">
            <div class="col-3">
    <div class="list-group border-primary">
        <a class="list-group-item list-group-item-action active" href="/">
            <h6><strong>孤舟蓑笠翁</strong></h6>
            <span class="font-weight-light">独钓寒江雪。CTF 解题报告</span>
        </a>
        <a class="list-group-item list-group-item-action " href="/notes">
            <h6><strong>温故而知新</strong></h6>
            <span class="font-weight-light">可以为师矣。知识笔记</span>
        </a>
        <a class="list-group-item list-group-item-action " href="/cheatsheets">
            <h6><strong>愿君多采撷</strong></h6>
            <span class="font-weight-light">此物最相思。Cheatsheets</span>
        </a>
        <a class="list-group-item list-group-item-action " href="/tools">
            <h6><strong>工欲善其事</strong></h6>
            <span class="font-weight-light">必先利其器。实用工具索引</span>
        </a>
        <!--a class="list-group-item list-group-item-action">
            海内存知己
        </a-->
    </div>
    <div class="card mt-5">
        <div class="card-header">
            近期发布
        </div>
        <div class="list-group list-group-flush">
            
            <a class="list-group-item list-group-item-action" href="/writeups/reversing-kr-easy-keygenme.html">
                <h6><strong>Easy KeygenMe</strong></h6>
                <span class="font-weight-light"><p>题目要求 Find the Name when the Serial is 5B134977135E7D13：</p>
</span>
                <small>2019年03月12日 | writeups | reversing</small>
            </a>
            
            <a class="list-group-item list-group-item-action" href="/notes/stack-buffer-overflow-canary.html">
                <h6><strong>栈缓冲区溢出之三 Security Cookie / Canary</strong></h6>
                <span class="font-weight-light"><p>当栈溢出发生时，如果能够检测到栈溢出已经发生，就可以及时中止程序的执行，从而能够避免继续走攻击者安排好的路。Windows 上的 Security Cookie 就是这样一种机制。在 Linux 上，Canary 这个名字更常用。不论是 Security Cookie 还是 Canary，它们的原理都是相同的。</p>
</span>
                <small>2019年02月28日 | notes | binary</small>
            </a>
            
            <a class="list-group-item list-group-item-action" href="/writeups/picoctf-2018-buffer-overflow-3.html">
                <h6><strong>Buffer Overflow 3</strong></h6>
                <span class="font-weight-light"><p>这道题模拟了栈溢出保护，但 canary 是固定的：</p>
</span>
                <small>2019年02月27日 | writeups | pwn</small>
            </a>
            
            <a class="list-group-item list-group-item-action" href="/writeups/picoctf-2018-buffer-overflow-012.html">
                <h6><strong>Buffer Overflow 0 / 1 / 2</strong></h6>
                <span class="font-weight-light"><p>因为这几道题都比较简单，所以合并在一起了：</p>
</span>
                <small>2019年02月26日 | writeups | pwn</small>
            </a>
            
            <a class="list-group-item list-group-item-action" href="/writeups/picoctf-2013-rop-4.html">
                <h6><strong>ROP 4</strong></h6>
                <span class="font-weight-light"><p>这道题是 PicoCTF 2013 ROP 系列的最后一题：</p>
</span>
                <small>2019年02月26日 | writeups | pwn</small>
            </a>
            
        </div>
    </div>
</div>
<div id="content" class="col-8 pl-4">
    <h1>Easy CrackMe</h1>
<span class="d-block"><small>发布日期：2019年02月03日</small></span>
<span class="d-block"><small>类别：reversing</small></span>

<span class="d-block">
    <small>题目来源：reversing.kr</small>
</span>


<span class="d-block">
    <small>题目链接：<a href="http://reversing.kr/challenge.php" target="_blank">http://reversing.kr/challenge.php</a>

    </small>
</span>


<hr />
<p>双击点开 <code>Easy CrackMe.exe</code>，将弹出一个对话框，要求输入密码。点击按钮后将对密码进行验证。</p>
<p><img src="/assets/local/posts/reversing-kr-easy-crackme/screenshot.png" alt="screenshot" /></p>
<div>
<div id="writeup_show_button" style="cursor: pointer">
    <div class="alert alert-warning">
        <b><i class="fas fa-exclamation-circle"></i> 点击此处显示 Writeup</b>
    </div>
</div>
<div id="writeup_hide_button" style="cursor: pointer" class="d-none">
    <div class="alert alert-info">
        <b><i class="fas fa-exclamation-circle"></i> 点击此处隐藏 Writeup</b>
    </div>
</div>
<script>
(function()
{
    var parent = document.scripts[document.scripts.length - 1].parentNode;
    parent.querySelector("#writeup_show_button").onclick = function ()
    {
        parent.querySelector("#writeup_hide_button").classList.remove("d-none");
        parent.querySelector("#writeup_show_button").classList.add("d-none");
        parent.querySelector("#writeup").classList.remove("d-none");
    }
    parent.querySelector("#writeup_hide_button").onclick = function ()
    {
        parent.querySelector("#writeup_hide_button").classList.add("d-none");
        parent.querySelector("#writeup_show_button").classList.remove("d-none");
        parent.querySelector("#writeup").classList.add("d-none");
    }
})();
</script>
<div id="writeup" class="d-none" markdown="1">
<p>首先用 Cutter 打开 <code>Easy CrackMe.exe</code>，看看 Strings 里面有没有什么特别的：</p>
<p><img src="/assets/local/posts/reversing-kr-easy-crackme/strings.png" alt="strings" /></p>
<p><code>AGR3versing</code> 似乎有点奇怪。输进去看看，不对。除此之外，就是 <code>Wrong Password</code> 和 <code>Congratulations</code> 最吸引我们了。看一下 <code>Congratulations</code> 的交叉引用，跳到了：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource asm numberLines"><code class="sourceCode fasm"><a class="sourceLine" id="cb1-1" title="1">|      ||<span class="bn">   0x00401114      </span><span class="bu">push</span><span class="bn"> 0x40 </span><span class="co">; &#39;@&#39; ; 64</span></a>
<a class="sourceLine" id="cb1-2" title="2">|      ||<span class="bn">   0x00401116      </span><span class="bu">push</span> <span class="bu">str</span>.EasyCrackMe <span class="co">; 0x406058 ; &quot;EasyCrackMe&quot;</span></a>
<a class="sourceLine" id="cb1-3" title="3">|      ||<span class="bn">   0x0040111b      </span><span class="bu">push</span> <span class="bu">str</span>.Congratulation <span class="co">; 0x406044 ; &quot;Congratulation !!&quot;</span></a>
<a class="sourceLine" id="cb1-4" title="4">|      ||<span class="bn">   0x00401120      </span><span class="bu">push</span> <span class="kw">edi</span></a>
<a class="sourceLine" id="cb1-5" title="5">|      ||<span class="bn">   0x00401121      </span><span class="bu">call</span> <span class="dt">dword</span> [sym.imp.USER32.dll_MessageBoxA] <span class="co">; 0x4050a0 ; &quot;NU&quot;</span></a>
<a class="sourceLine" id="cb1-6" title="6">|      ||<span class="bn">   0x00401127      </span><span class="bu">push</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb1-7" title="7">|      ||<span class="bn">   0x00401129      </span><span class="bu">push</span> <span class="kw">edi</span></a>
<a class="sourceLine" id="cb1-8" title="8">|      ||<span class="bn">   0x0040112a      </span><span class="bu">call</span> <span class="dt">dword</span> [sym.imp.USER32.dll_EndDialog] <span class="co">; 0x4050a4 ; &quot;BU&quot;</span></a>
<a class="sourceLine" id="cb1-9" title="9">|      ||<span class="bn">   0x00401130      </span><span class="bu">pop</span>  <span class="kw">edi</span></a>
<a class="sourceLine" id="cb1-10" title="10">|      ||<span class="bn">   0x00401131      </span><span class="bu">add</span>  <span class="kw">esp</span><span class="bn">, 0x64 </span><span class="co">; &#39;d&#39;</span></a>
<a class="sourceLine" id="cb1-11" title="11">|      ||<span class="bn">   0x00401134      </span><span class="bu">ret</span></a>
<a class="sourceLine" id="cb1-12" title="12">|      ``-&gt;<span class="bn"> 0x00401135      </span><span class="bu">push</span><span class="bn"> 0x10 </span><span class="co">; 16</span></a>
<a class="sourceLine" id="cb1-13" title="13">|<span class="bn">           0x00401137      </span><span class="bu">push</span> <span class="bu">str</span>.EasyCrackMe <span class="co">; 0x406058 ; &quot;EasyCrackMe&quot;</span></a>
<a class="sourceLine" id="cb1-14" title="14">|<span class="bn">           0x0040113c      </span><span class="bu">push</span> <span class="bu">str</span>.Incorrect_Password <span class="co">; 0x406030 ; &quot;Incorrect Password&quot;</span></a>
<a class="sourceLine" id="cb1-15" title="15">|<span class="bn">           0x00401141      </span><span class="bu">push</span> <span class="kw">edi</span></a>
<a class="sourceLine" id="cb1-16" title="16">|<span class="bn">           0x00401142      </span><span class="bu">call</span> <span class="dt">dword</span> [sym.imp.USER32.dll_MessageBoxA] <span class="co">; 0x4050a0 ; &quot;NU&quot;</span></a>
<a class="sourceLine" id="cb1-17" title="17">|<span class="bn">           0x00401148      </span><span class="bu">pop</span>  <span class="kw">edi</span></a>
<a class="sourceLine" id="cb1-18" title="18">|<span class="bn">           0x00401149      </span><span class="bu">add</span>  <span class="kw">esp</span><span class="bn">, 0x64 </span><span class="co">; &#39;d&#39;</span></a>
<a class="sourceLine" id="cb1-19" title="19">\<span class="bn">           0x0040114c      </span><span class="bu">ret</span></a></code></pre></div>
<p>看起来这就是最终弹出检查结果的地方了。往上翻一下，在同一个函数里面，就是检查的逻辑：</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource asm numberLines"><code class="sourceCode fasm"><a class="sourceLine" id="cb2-1" title="1">/ (fcn) <span class="bu">sub</span>.USER32.dll_GetDlgItemTextA_<span class="dv">401080</span> <span class="dv">205</span></a>
<a class="sourceLine" id="cb2-2" title="2">|   long <span class="bu">sub</span>.USER32.dll_GetDlgItemTextA_<span class="dv">401080</span> (HWND hDlg, <span class="bu">int</span> nIDDlgItem, LPSTR lpString, <span class="bu">int</span> nMaxCount)<span class="co">;</span></a>
<a class="sourceLine" id="cb2-3" title="3">|           <span class="co">; var unsigned int local_4h @ esp+0x4</span></a>
<a class="sourceLine" id="cb2-4" title="4">|           <span class="co">; var unsigned int local_5h @ esp+0x5</span></a>
<a class="sourceLine" id="cb2-5" title="5">|           <span class="co">; var int local_8h @ esp+0x8</span></a>
<a class="sourceLine" id="cb2-6" title="6">|           <span class="co">; var int local_ah @ esp+0xa</span></a>
<a class="sourceLine" id="cb2-7" title="7">|           <span class="co">; var int local_10h @ esp+0x10</span></a>
<a class="sourceLine" id="cb2-8" title="8">|           <span class="co">; arg int arg_70h @ esp+0x70</span></a>
<a class="sourceLine" id="cb2-9" title="9">|<span class="bn">           0x00401080      </span><span class="bu">sub</span>  <span class="kw">esp</span><span class="bn">, 0x64 </span><span class="co">; &#39;d&#39;</span></a>
<a class="sourceLine" id="cb2-10" title="10">|<span class="bn">           0x00401083      </span><span class="bu">push</span> <span class="kw">edi</span></a>
<a class="sourceLine" id="cb2-11" title="11">|<span class="bn">           0x00401084      </span><span class="bu">mov</span>  <span class="kw">ecx</span><span class="bn">, 0x18 </span><span class="co">; 24</span></a>
<a class="sourceLine" id="cb2-12" title="12">|<span class="bn">           0x00401089      </span><span class="bu">xor</span>  <span class="kw">eax</span>, <span class="kw">eax</span></a>
<a class="sourceLine" id="cb2-13" title="13">|<span class="bn">           0x0040108b      </span><span class="bu">lea</span>  <span class="kw">edi</span>, [local_5h] <span class="co">; 5</span></a>
<a class="sourceLine" id="cb2-14" title="14">|<span class="bn">           0x0040108f      </span><span class="bu">mov</span>  <span class="dt">byte</span> [local_4h], <span class="dv">0</span></a>
<a class="sourceLine" id="cb2-15" title="15">|<span class="bn">           0x00401094      </span><span class="bu">push</span><span class="bn"> 0x64 </span><span class="co">; &#39;d&#39; ; 100</span></a>
<a class="sourceLine" id="cb2-16" title="16">|<span class="bn">           0x00401096      </span>rep  <span class="bu">stosd</span> <span class="dt">dword</span> <span class="kw">es</span>:[<span class="kw">edi</span>], <span class="kw">eax</span></a>
<a class="sourceLine" id="cb2-17" title="17">|<span class="bn">           0x00401098      </span><span class="bu">stosw</span> <span class="dt">word</span> <span class="kw">es</span>:[<span class="kw">edi</span>], <span class="kw">ax</span></a>
<a class="sourceLine" id="cb2-18" title="18">|<span class="bn">           0x0040109a      </span><span class="bu">stosb</span> <span class="dt">byte</span> <span class="kw">es</span>:[<span class="kw">edi</span>], <span class="kw">al</span></a>
<a class="sourceLine" id="cb2-19" title="19">|<span class="bn">           0x0040109b      </span><span class="bu">mov</span>  <span class="kw">edi</span>, <span class="dt">dword</span> [arg_70h] <span class="co">; [0x70:4]=-1 ; &#39;p&#39; ; 112</span></a>
<a class="sourceLine" id="cb2-20" title="20">|<span class="bn">           0x0040109f      </span><span class="bu">lea</span>  <span class="kw">eax</span>, [local_8h] <span class="co">; 8 ;; !local_4h</span></a>
<a class="sourceLine" id="cb2-21" title="21">|<span class="bn">           0x004010a3      </span><span class="bu">push</span> <span class="kw">eax</span></a>
<a class="sourceLine" id="cb2-22" title="22">|<span class="bn">           0x004010a4      </span><span class="bu">push</span><span class="bn"> 0x3e8 </span><span class="co">; 1000</span></a>
<a class="sourceLine" id="cb2-23" title="23">|<span class="bn">           0x004010a9      </span><span class="bu">push</span> <span class="kw">edi</span></a>
<a class="sourceLine" id="cb2-24" title="24">|<span class="bn">           0x004010aa      </span><span class="bu">call</span> <span class="dt">dword</span> [sym.imp.USER32.dll_GetDlgItemTextA] <span class="co">; 0x40509c ; &quot;\U&quot;</span></a>
<a class="sourceLine" id="cb2-25" title="25">|<span class="bn">           0x004010b0      </span><span class="bu">cmp</span>  <span class="dt">byte</span> [local_5h]<span class="bn">, 0x61 </span><span class="co">; &#39;a&#39; ; [0x5:1]=255 ; 97</span></a>
<a class="sourceLine" id="cb2-26" title="26">|       ,=&lt;<span class="bn"> 0x004010b5      </span><span class="bu">jne</span><span class="bn">  0x401135</span></a>
<a class="sourceLine" id="cb2-27" title="27">|       |<span class="bn">   0x004010b7      </span><span class="bu">push</span> <span class="dv">2</span> <span class="co">; 2</span></a>
<a class="sourceLine" id="cb2-28" title="28">|       |<span class="bn">   0x004010b9      </span><span class="bu">lea</span>  <span class="kw">ecx</span>, </a>
<a class="sourceLine" id="cb2-29" title="29">|<span class="bn">           0x004010b9      </span><span class="bu">lea</span>  <span class="kw">ecx</span>, [local_ah] <span class="co">; 0xa ; 10 ;; local_6h</span></a>
<a class="sourceLine" id="cb2-30" title="30">|<span class="bn">           0x004010bd      </span><span class="bu">push</span><span class="bn"> 0x406078 </span><span class="co">; &#39;x`@&#39; ; &quot;5y&quot;</span></a>
<a class="sourceLine" id="cb2-31" title="31">|<span class="bn">           0x004010c2      </span><span class="bu">push</span> <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb2-32" title="32">|<span class="bn">           0x004010c3      </span><span class="bu">call</span> fcn<span class="fl">.00401150</span></a>
<a class="sourceLine" id="cb2-33" title="33">|<span class="bn">           0x004010c8      </span><span class="bu">add</span>  <span class="kw">esp</span>, <span class="bn">0xc</span></a>
<a class="sourceLine" id="cb2-34" title="34">|<span class="bn">           0x004010cb      </span><span class="bu">test</span> <span class="kw">eax</span>, <span class="kw">eax</span></a>
<a class="sourceLine" id="cb2-35" title="35">|       ,=&lt;<span class="bn"> 0x004010cd      </span><span class="bu">jne</span><span class="bn">  0x401135</span></a>
<a class="sourceLine" id="cb2-36" title="36">|       |<span class="bn">   0x004010cf      </span><span class="bu">push</span> <span class="kw">ebx</span></a>
<a class="sourceLine" id="cb2-37" title="37">|       |<span class="bn">   0x004010d0      </span><span class="bu">push</span> <span class="kw">esi</span></a>
<a class="sourceLine" id="cb2-38" title="38">|       |<span class="bn">   0x004010d1      </span><span class="bu">mov</span>  <span class="kw">esi</span><span class="bn">, 0x40606c </span><span class="co">; &#39;l`@&#39; ; &quot;R3versing&quot;</span></a>
<a class="sourceLine" id="cb2-39" title="39">|       |<span class="bn">   0x004010d6      </span><span class="bu">lea</span>  <span class="kw">eax</span>, [local_10h] <span class="co">; 0x10 ; 16 ;; local_8h</span></a>
<a class="sourceLine" id="cb2-40" title="40">|      .--&gt;<span class="bn"> 0x004010da      </span><span class="bu">mov</span>  <span class="kw">dl</span>, <span class="dt">byte</span> [<span class="kw">eax</span>]</a>
<a class="sourceLine" id="cb2-41" title="41">|      :|<span class="bn">   0x004010dc      </span><span class="bu">mov</span>  <span class="kw">bl</span>, <span class="dt">byte</span> [<span class="kw">esi</span>]</a>
<a class="sourceLine" id="cb2-42" title="42">|      :|<span class="bn">   0x004010de      </span><span class="bu">mov</span>  <span class="kw">cl</span>, <span class="kw">dl</span></a>
<a class="sourceLine" id="cb2-43" title="43">|      :|<span class="bn">   0x004010e0      </span><span class="bu">cmp</span>  <span class="kw">dl</span>, <span class="kw">bl</span></a>
<a class="sourceLine" id="cb2-44" title="44">|     ,===&lt;<span class="bn"> 0x004010e2      </span><span class="bu">jne</span><span class="bn">  0x401102</span></a>
<a class="sourceLine" id="cb2-45" title="45">|     |:|<span class="bn">   0x004010e4      </span><span class="bu">test</span> <span class="kw">cl</span>, <span class="kw">cl</span></a>
<a class="sourceLine" id="cb2-46" title="46">|    ,====&lt;<span class="bn"> 0x004010e6      </span><span class="bu">je</span><span class="bn">   0x4010fe</span></a>
<a class="sourceLine" id="cb2-47" title="47">|    ||:|<span class="bn">   0x004010e8      </span><span class="bu">mov</span>  <span class="kw">dl</span>, <span class="dt">byte</span> [<span class="kw">eax</span> + <span class="dv">1</span>] <span class="co">; [0x1:1]=255 ; 1</span></a>
<a class="sourceLine" id="cb2-48" title="48">|    ||:|<span class="bn">   0x004010eb      </span><span class="bu">mov</span>  <span class="kw">bl</span>, <span class="dt">byte</span> [<span class="kw">esi</span> + <span class="dv">1</span>] <span class="co">; [0x1:1]=255 ; 1</span></a>
<a class="sourceLine" id="cb2-49" title="49">|    ||:|<span class="bn">   0x004010ee      </span><span class="bu">mov</span>  <span class="kw">cl</span>, <span class="kw">dl</span></a>
<a class="sourceLine" id="cb2-50" title="50">|    ||:|<span class="bn">   0x004010f0      </span><span class="bu">cmp</span>  <span class="kw">dl</span>, <span class="kw">bl</span></a>
<a class="sourceLine" id="cb2-51" title="51">|   ,=====&lt;<span class="bn"> 0x004010f2      </span><span class="bu">jne</span><span class="bn">  0x401102</span></a>
<a class="sourceLine" id="cb2-52" title="52">|   |||:|<span class="bn">   0x004010f4      </span><span class="bu">add</span>  <span class="kw">eax</span>, <span class="dv">2</span></a>
<a class="sourceLine" id="cb2-53" title="53">|   |||:|<span class="bn">   0x004010f7      </span><span class="bu">add</span>  <span class="kw">esi</span>, <span class="dv">2</span></a>
<a class="sourceLine" id="cb2-54" title="54">|   |||:|<span class="bn">   0x004010fa      </span><span class="bu">test</span> <span class="kw">cl</span>, <span class="kw">cl</span></a>
<a class="sourceLine" id="cb2-55" title="55">|   |||`==&lt;<span class="bn"> 0x004010fc      </span><span class="bu">jne</span><span class="bn">  0x4010da</span></a>
<a class="sourceLine" id="cb2-56" title="56">|   |`----&gt;<span class="bn"> 0x004010fe      </span><span class="bu">xor</span>  <span class="kw">eax</span>, <span class="kw">eax</span></a>
<a class="sourceLine" id="cb2-57" title="57">|   | |,==&lt;<span class="bn"> 0x00401100      </span><span class="bu">jmp</span><span class="bn">  0x401107</span></a>
<a class="sourceLine" id="cb2-58" title="58">|   `-`---&gt;<span class="bn"> 0x00401102      </span><span class="bu">sbb</span>  <span class="kw">eax</span>, <span class="kw">eax</span></a>
<a class="sourceLine" id="cb2-59" title="59">|      ||<span class="bn">   0x00401104      </span><span class="bu">sbb</span>  <span class="kw">eax</span>, <span class="bn">0xffffffffffffffff</span></a>
<a class="sourceLine" id="cb2-60" title="60">|      `--&gt;<span class="bn"> 0x00401107      </span><span class="bu">pop</span>  <span class="kw">esi</span></a>
<a class="sourceLine" id="cb2-61" title="61">|       |<span class="bn">   0x00401108      </span><span class="bu">pop</span>  <span class="kw">ebx</span></a>
<a class="sourceLine" id="cb2-62" title="62">|       |<span class="bn">   0x00401109      </span><span class="bu">test</span> <span class="kw">eax</span>, <span class="kw">eax</span></a>
<a class="sourceLine" id="cb2-63" title="63">|      ,==&lt;<span class="bn"> 0x0040110b      </span><span class="bu">jne</span><span class="bn">  0x401135</span></a>
<a class="sourceLine" id="cb2-64" title="64">|      ||<span class="bn">   0x0040110d      </span><span class="bu">cmp</span>  <span class="dt">byte</span> [local_4h]<span class="bn">, 0x45 </span><span class="co">; &#39;E&#39; ; [0x4:1]=255 ; 69</span></a>
<a class="sourceLine" id="cb2-65" title="65">|     ,===&lt;<span class="bn"> 0x00401112      </span><span class="bu">jne</span><span class="bn">  0x401135</span></a>
<a class="sourceLine" id="cb2-66" title="66">|     |||<span class="bn">   0x00401114      </span><span class="bu">push</span><span class="bn"> 0x40 </span><span class="co">; &#39;@&#39; ; 64</span></a>
<a class="sourceLine" id="cb2-67" title="67">|     |||<span class="bn">   0x00401116      </span><span class="bu">push</span> <span class="bu">str</span>.EasyCrackMe <span class="co">; 0x406058 ; &quot;EasyCrackMe&quot;</span></a>
<a class="sourceLine" id="cb2-68" title="68">|     |||<span class="bn">   0x0040111b      </span><span class="bu">push</span> <span class="bu">str</span>.Congratulation <span class="co">; 0x406044 ; &quot;Congratulation !!&quot;</span></a></code></pre></div>
<p>由于这个函数的局部变量由 esp 索引，而 R2 没有捕捉到 esp 的变化，导致函数中的变量名的使用会有些误导，在分析时需要注意。举例来说，上面的代码片段 14 行有一处 push，导致第 20 行的 local_8h（esp+8）实际应为 local_4h。我在有问题的语句后做了注释。</p>
<p>首先来看第 24 行，<code>GetDlgItemText</code> 是一个 Win32 API，其中第三个参数是字符串的地址。第 21 行压入的 eax 即为第三个参数，它指向的是 <code>local_4h</code>，因此 <code>local_4h</code> 就是字符串的第零个字符的地址。</p>
<p>随后，第 25 行判断了一下第一个字符的内容是否为 <code>a</code>；第 32 行将 <code>5y</code> 和第三个字符地址的地址传入了 <code>fcn.00401150</code>。去看一下这个函数：</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource asm numberLines"><code class="sourceCode fasm"><a class="sourceLine" id="cb3-1" title="1">/ (fcn) fcn<span class="fl">.00401150</span> <span class="dv">56</span></a>
<a class="sourceLine" id="cb3-2" title="2">|   fcn<span class="fl">.00401150</span> (<span class="bu">int</span> arg_<span class="bn">8h, </span>unsigned <span class="bu">int</span> arg_<span class="bn">ch, </span><span class="bu">int</span> arg_10h)<span class="co">;</span></a>
<a class="sourceLine" id="cb3-3" title="3">|           <span class="co">; arg int arg_8h @ ebp+0x8</span></a>
<a class="sourceLine" id="cb3-4" title="4">|           <span class="co">; arg unsigned int arg_ch @ ebp+0xc</span></a>
<a class="sourceLine" id="cb3-5" title="5">|           <span class="co">; arg int arg_10h @ ebp+0x10</span></a>
<a class="sourceLine" id="cb3-6" title="6">|<span class="bn">           0x00401150      </span><span class="bu">push</span> <span class="kw">ebp</span></a>
<a class="sourceLine" id="cb3-7" title="7">|<span class="bn">           0x00401151      </span><span class="bu">mov</span>  <span class="kw">ebp</span>, <span class="kw">esp</span></a>
<a class="sourceLine" id="cb3-8" title="8">|<span class="bn">           0x00401153      </span><span class="bu">push</span> <span class="kw">edi</span></a>
<a class="sourceLine" id="cb3-9" title="9">|<span class="bn">           0x00401154      </span><span class="bu">push</span> <span class="kw">esi</span></a>
<a class="sourceLine" id="cb3-10" title="10">|<span class="bn">           0x00401155      </span><span class="bu">push</span> <span class="kw">ebx</span></a>
<a class="sourceLine" id="cb3-11" title="11">|<span class="bn">           0x00401156      </span><span class="bu">mov</span>  <span class="kw">ecx</span>, <span class="dt">dword</span> [arg_10h] <span class="co">; [0x10:4]=-1 ; 16</span></a>
<a class="sourceLine" id="cb3-12" title="12">|       ,=&lt;<span class="bn"> 0x00401159      </span><span class="bu">jecxz</span><span class="bn"> 0x401181</span></a>
<a class="sourceLine" id="cb3-13" title="13">|       |<span class="bn">   0x0040115b      </span><span class="bu">mov</span>  <span class="kw">ebx</span>, <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb3-14" title="14">|       |<span class="bn">   0x0040115d      </span><span class="bu">mov</span>  <span class="kw">edi</span>, <span class="dt">dword</span> [arg_8h] <span class="co">; [0x8:4]=-1 ; 8</span></a>
<a class="sourceLine" id="cb3-15" title="15">|       |<span class="bn">   0x00401160      </span><span class="bu">mov</span>  <span class="kw">esi</span>, <span class="kw">edi</span></a>
<a class="sourceLine" id="cb3-16" title="16">|       |<span class="bn">   0x00401162      </span><span class="bu">xor</span>  <span class="kw">eax</span>, <span class="kw">eax</span></a>
<a class="sourceLine" id="cb3-17" title="17">|       |<span class="bn">   0x00401164      </span>repne <span class="bu">scasb</span> <span class="kw">al</span>, <span class="dt">byte</span> <span class="kw">es</span>:[<span class="kw">edi</span>]</a>
<a class="sourceLine" id="cb3-18" title="18">|       |<span class="bn">   0x00401166      </span><span class="bu">neg</span>  <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb3-19" title="19">|       |<span class="bn">   0x00401168      </span><span class="bu">add</span>  <span class="kw">ecx</span>, <span class="kw">ebx</span></a>
<a class="sourceLine" id="cb3-20" title="20">|       |<span class="bn">   0x0040116a      </span><span class="bu">mov</span>  <span class="kw">edi</span>, <span class="kw">esi</span></a>
<a class="sourceLine" id="cb3-21" title="21">|       |<span class="bn">   0x0040116c      </span><span class="bu">mov</span>  <span class="kw">esi</span>, <span class="dt">dword</span> [arg_ch] <span class="co">; [0xc:4]=-1 ; 12</span></a>
<a class="sourceLine" id="cb3-22" title="22">|       |<span class="bn">   0x0040116f      </span>repe <span class="bu">cmpsb</span> <span class="dt">byte</span> [<span class="kw">esi</span>], <span class="dt">byte</span> <span class="dt">ptr</span> <span class="kw">es</span>:[<span class="kw">edi</span>]</a>
<a class="sourceLine" id="cb3-23" title="23">|       |<span class="bn">   0x00401171      </span><span class="bu">mov</span>  <span class="kw">al</span>, <span class="dt">byte</span> [<span class="kw">esi</span> - <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb3-24" title="24">|       |<span class="bn">   0x00401174      </span><span class="bu">xor</span>  <span class="kw">ecx</span>, <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb3-25" title="25">|       |<span class="bn">   0x00401176      </span><span class="bu">cmp</span>  <span class="kw">al</span>, <span class="dt">byte</span> [<span class="kw">edi</span> - <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb3-26" title="26">|      ,==&lt;<span class="bn"> 0x00401179      </span><span class="bu">ja</span><span class="bn">   0x40117f</span></a>
<a class="sourceLine" id="cb3-27" title="27">|     ,===&lt;<span class="bn"> 0x0040117b      </span><span class="bu">je</span><span class="bn">   0x401181</span></a>
<a class="sourceLine" id="cb3-28" title="28">|     |||<span class="bn">   0x0040117d      </span><span class="bu">dec</span>  <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb3-29" title="29">|     |||<span class="bn">   0x0040117e      </span><span class="bu">dec</span>  <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb3-30" title="30">|     |`--&gt;<span class="bn"> 0x0040117f      </span><span class="bu">not</span>  <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb3-31" title="31">|     `-`-&gt;<span class="bn"> 0x00401181      </span><span class="bu">mov</span>  <span class="kw">eax</span>, <span class="kw">ecx</span></a>
<a class="sourceLine" id="cb3-32" title="32">|<span class="bn">           0x00401183      </span><span class="bu">pop</span>  <span class="kw">ebx</span></a>
<a class="sourceLine" id="cb3-33" title="33">|<span class="bn">           0x00401184      </span><span class="bu">pop</span>  <span class="kw">esi</span></a>
<a class="sourceLine" id="cb3-34" title="34">|<span class="bn">           0x00401185      </span><span class="bu">pop</span>  <span class="kw">edi</span></a>
<a class="sourceLine" id="cb3-35" title="35">|<span class="bn">           0x00401186      </span><span class="bu">leave</span></a>
<a class="sourceLine" id="cb3-36" title="36">\<span class="bn">           0x00401187      </span><span class="bu">ret</span></a></code></pre></div>
<p>看起来只是在做字符串比较，所以第三四个字符应该是 <code>5y</code> 。再继续看，从第38行开始，字符串 <code>R3versing</code> 出现了，下面的代码又是在不断地比较每一个字符是否与 <code>R3versing</code> 相同。最后 64 行比较了第一个字符是否为 <code>E</code>，至此密码已经找到了：<flag>Ea5yR3versing</flag>。</p>
</div>
</div>


</div>

        </div>
        <div class="mt-5 p-5 bg-light text-muted">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-4">
                        <h5>dontpan1c 的 CTF 笔记</h5>
                        <span class="d-block font-weight-light">南阳一出即相，淮阴一出即将。</span>
                        <div class="btn-toolbar mt-4">
                            <div class="btn-group">
                              <a class="btn btn-secondary" href="https://github.com/dontpanic92"
                              target="_blank"><i class="fab fa-fw fa-github"></i></a>
                              <a class="btn btn-secondary" href="https://zhihu.com/people/li-sheng-qiu"
                              target="_blank"><i class="fab fa-fw fa-zhihu"></i></a>
                              <a class="btn btn-secondary" href="https://weibo.com/1184181045/profile"
                              target="_blank"><i class="fab fa-fw fa-weibo"></i></a>
                              <a class="btn btn-secondary" href="https://linkedin.com/in/lishengqiu"
                              target="_blank"><i class="fab fa-fw fa-linkedin-in"></i></a>
                              <a class="btn btn-secondary" href="https://stackoverflow.com/users/3196456"
                              target="_blank"><i class="fab fa-fw fa-stack-overflow"></i></a>
                              <a class="btn btn-secondary" href="http://renren.com/419200039"
                              target="_blank"><i class="fab fa-fw fa-renren"></i></a>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license"><img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"
                                    alt="知识共享许可协议"></a></p>
                        <p><small>本站所有作品均采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="license">知识共享署名-非商业性使用-相同方式共享
                                    4.0 国际许可协议</a>进行许可。</small></p>
                        <p><small>本站不包含明令禁止公开解题过程的题目。</small></p>
                        <span><small>本站由 <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> 强力驱动。</small></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>